<div class="spinner__center" *ngIf="!media">
  <p-progressSpinner></p-progressSpinner>
</div>
<section id="details" *ngIf="media">
  <app-featured [media]="media" [isDetailPage]="true"></app-featured>
  <div class="container">
    <div [class.row]="media.tvShow">
      <div class="detail detail__info" [class.col-sm-6]="media.tvShow">
        <h3 class="fw-bold">Information</h3>
        <div class="detail__info-content">
          <p class="mb-5px detail__info-overview" *ngIf="media.overview">{{media.overview}}</p>
          <p class="mb-5px"><span>Genres:</span> {{(media.genres | join: ', ') || 'None'}}</p>
          <p class="mb-5px" *ngIf="media.movie"><span>Release:</span> {{(media.movie.releaseDate | date: 'mediumDate') || 'Unknown'}}</p>
          <p class="mb-5px" *ngIf="media.movie"><span>Duration:</span> {{media.movie.runtime || '0'}} min</p>
          <p class="mb-5px" *ngIf="media.movie"><span>Status:</span> {{media.movie.status || 'None'}}</p>
          <p class="mb-5px" *ngIf="media.tvShow"><span>Release:</span> {{(media.tvShow.firstAirDate | date: 'mediumDate') || 'Unknown'}} to {{(media.tvShow.lastAirDate | date: 'mediumDate') || 'Unknown'}}</p>
          <p class="mb-5px" *ngIf="media.tvShow"><span>Seasons:</span> {{media.tvShow.seasonCount || '0'}}</p>
          <p class="mb-5px" *ngIf="media.tvShow"><span>Duration:</span> {{(media.tvShow.episodeRuntime | join: ', ') || '0'}} min per ep</p>
          <p class="mb-5px" *ngIf="media.tvShow"><span>Status:</span> {{media.tvShow.status || 'None'}}</p>
        </div>
      </div>
      <div class="detail detail__tv col-sm-6" *ngIf="media.tvShow">
        <h3 class="fw-bold">Episodes</h3>
        <p *ngIf="!media.tvShow.seasons.length">No seasons available</p>
        <div class="detail__tv-season" *ngFor="let season of media.tvShow.seasons; let index = index;">
          <p class="fw-bold">Season {{season.seasonNumber}}</p>
          <div class="detail__tv-episode d-flex flex-wrap gap-1">
            <p *ngIf="!media.tvShow.seasons[index].episodes.length">No episodes available</p>
            <ng-container *ngFor="let episode of media.tvShow.seasons[index].episodes; let index = index;">
              <button pButton class="p-button-outlined p-button-rounded p-button-sm" [label]="episode.episodeNumber + ''" [routerLink]="['/watch', media._id]" [queryParams]="{ s: season.seasonNumber, e: episode.episodeNumber}"></button>
            </ng-container>
          </div>
        </div>
      </div>
    </div>
    <div class="detail detail__credits">
      <h3 class="fw-bold">Cast & Crew</h3>
      <p *ngIf="!media.credits.length">No members available</p>
      <div class="d-flex flex-row scroll-x">
        <div *ngFor="let credit of media.credits" class="col-xl-1 col-lg-2 col-md-3 col-sm-4 col-4">
          <div class="credit__card">
            <div class="credit__card-image ratio">
              <img *ngIf="credit.profilePath" class="br-2px" [lazyLoad]="(credit.profilePath)" [defaultImage]="(credit.profilePath + '&w=48&h=48')" [alt]="(credit?.name || 'Profile image')">
              <img *ngIf="!credit.profilePath" class="br-2px" lazyLoad="assets/img/credit-person-md.png" defaultImage="assets/img/credit-person-sm.png" alt="Profile image">
            </div>
            <div class="credit__card-content">
              <p class="name m-0">{{credit.name}}</p>
              <p *ngIf="credit.cast" class="character">{{credit.cast.character}}</p>
              <p *ngIf="credit.crew" class="job">{{credit.crew.job}}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="detail detail__videos">
      <h3 class="fw-bold">Videos</h3>
      <p *ngIf="!media.videos.length">No videos available</p>
      <div class="videos__inner">
        <p-galleria [value]="media.videos" [(visible)]="displayVideo" [(activeIndex)]="activeVideoIndex" [fullScreen]="true" [showThumbnails]="false" [containerStyle]="{'min-width': '80%', 'min-height': '80%'}" [baseZIndex]="1000">
          <ng-template pTemplate="item" let-video>
            <div class="ratio ratio-16x9">
              <iframe [src]="youtubeUrl + video.key + '?autoplay=1' | safe: 'resourceUrl'" allowfullscreen></iframe>
            </div>
          </ng-template>
        </p-galleria>
        <div *ngIf="media.videos" class="d-flex flex-row scroll-x">
          <div *ngFor="let video of media.videos; let index = index;" class="col-xl-4 col-lg-4 col-md-4 col-sm-6 col-12 video__item" key="index">
            <div class="ratio ratio-16x9">
              <img [src]="youtubeThumbnailUrl + video.key + '/hqdefault.jpg'" [alt]="video.title || ''" class="video__image br-2px" (click)="viewVideo(index)"/>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
